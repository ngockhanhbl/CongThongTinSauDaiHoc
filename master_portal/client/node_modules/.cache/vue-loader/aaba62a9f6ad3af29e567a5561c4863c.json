{"remainingRequest":"C:\\Users\\Ryan\\QL-HoSoBenhAn\\medicalproject\\client\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Ryan\\QL-HoSoBenhAn\\medicalproject\\client\\src\\components\\content\\Doctor.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Ryan\\QL-HoSoBenhAn\\medicalproject\\client\\src\\components\\content\\Doctor.vue","mtime":1593847511079},{"path":"C:\\Users\\Ryan\\QL-HoSoBenhAn\\medicalproject\\client\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Ryan\\QL-HoSoBenhAn\\medicalproject\\client\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\Ryan\\QL-HoSoBenhAn\\medicalproject\\client\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Ryan\\QL-HoSoBenhAn\\medicalproject\\client\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { mapGetters} from \"vuex\";\r\nimport DoctorService from '@/services/DoctorService'\r\nimport PageNotFound from '@/components/content/PageNotFound.vue'\r\nimport PatientView from '@/components/content/patient_modules/PatientView.vue'\r\nimport PatientData from '@/components/content/patient_modules/PatientData.vue'\r\nimport PatientService from '@/services/PatientService'\r\nimport HospitalService from '@/services/HospitalService'\r\nimport axios from 'axios'\r\nexport default {\r\n  data(){\r\n        return{\r\n            messageError:'',\r\n            selected:'',\r\n            doctor_email_record:'',          \r\n            doctor_right_record:'',\r\n            isWriteRecord:false,\r\n            error_access_record:null,\r\n            titleRecord:'',\r\n            diagnoseRecord:'',\r\n            errors: null,\r\n            Istruycap:false,\r\n            idRecord:null,\r\n            describe:'',\r\n            listSystem:'',\r\n            listDrug:'',\r\n            passwordchangeValue:'',\r\n            passwordchangeValueAgain:'',\r\n            get isUserLoggedIn() {\r\n                return localStorage.getItem('isUserLoggedIn' || false);\r\n              },\r\n            NewDrugs:[\r\n              {\r\n                name:'',\r\n                id_record:'',\r\n                total:'',\r\n                morning:'',\r\n                midday:'',\r\n                afternoon:'',\r\n                night:'',\r\n                note:'',\r\n              }\r\n            ],\r\n            \r\n            files: [],\r\n            isHideNewAlternativeRecord:true\r\n        }\r\n    },\r\n      computed: {\r\n        ...mapGetters([\"patient_records\",\"doctorInfo\",\"hospitalInfo\",\"patientInfo\"]),\r\n        LoadListDrug: function () {\r\n          if(this.selected == 'LoadListHopital'){\r\n            return this.listDrug;\r\n          }else if(this.selected == 'LoadListSystem'){\r\n            return this.listSystem;\r\n          }else{\r\n            return '';\r\n          }\r\n        }\r\n      },\r\n      components: {\r\n        \"app-TimeLine\": PatientView,  \r\n        \"app-PatientData\": PatientData,\r\n        \"app-PageNotFound\":PageNotFound\r\n      },\r\n    async mounted() {\r\n        const userCONST = JSON.parse(localStorage.getItem('user'));\r\n\r\n        if(userCONST){\r\n          this.user = userCONST\r\n          const id_account = JSON.parse(localStorage.getItem('user')).id;\r\n\r\n          const payload_doctor = (await DoctorService.getInfoDoctor(id_account)).data\r\n          this.$store.dispatch(\"setDoctorInfo\",payload_doctor)\r\n\r\n          const payload_hospital = (await HospitalService.getInfoHospital(payload_doctor.id_hospital)).data\r\n          this.$store.dispatch(\"setHospitalInfo\",payload_hospital);\r\n\r\n          const ListDrugHospital = (await HospitalService.getListDrugBank(userCONST.id)).data;\r\n          this.listDrug = ListDrugHospital.map(x=>x.tenThuoc)\r\n        }\r\n        await axios\r\n        .get('https://www.drugbank.vn/services/drugbank/api/public/thuoc?page=1&size=2000&fbclid=IwAR1vamwLTdSmIx8idqXMjg77a18AZ4nZYROoLE8dTTAR0sS4EUlvt7W3lMQ')\r\n        .then(response => (this.listSystem = response.data.filter(x=>x.tenThuoc).map(x=>x.tenThuoc)));\r\n      },\r\n  methods: {\r\n      validationPasswordChange(){\r\n        if(!this.passwordchangeValue || !this.passwordchangeValueAgain){\r\n            this.$toasted.show('Vui Lòng Nhập Đầy Đủ Thông Tin !!!', { \r\n            theme: \"bubble\",\r\n            position: \"bottom-right\", \r\n            duration : 4000\r\n        });\r\n        }else if(this.passwordchangeValue !== this.passwordchangeValueAgain){\r\n          this.$toasted.show(`Mật Khẩu Và Mật Khẩu Xác Nhận Không Giống Nhau !!!<br>Vui Lòng Kiểm Tra Lại !!!`, { \r\n            theme: \"bubble\", \r\n            position: \"bottom-right\", \r\n            duration : 5000\r\n        });\r\n        }else if(this.passwordchangeValue.length < 8){\r\n          this.$toasted.show(`Mật khẩu được cung cấp phải khớp với các quy tắc sau:\\n            <br><br>\\n            1. Nó phải chứa chỉ các ký tự sau: chữ thường, chữ hoa, chữ số.\\n            <br><br>\\n            2. mật khẩu dài ít nhất 8 kí tự và không dài hơn 32 kí tự.\\n            </div>\\n        `, { \r\n            theme: \"bubble\", \r\n            position: \"bottom-right\", \r\n            duration : 4000\r\n        });\r\n        }else{\r\n          this.changepassword();\r\n          this.closeModal3();\r\n        }\r\n    },\r\n    closeModal3(){\r\n        this.passwordchangeValue = ''\r\n        this.passwordchangeValueAgain = ''\r\n        this.$root.$emit('bv::hide::modal', \"modal-3\", \"button\")\r\n      },\r\n    async changepassword(){\r\n        try {\r\n            await PatientService.changePassword({\r\n              id_account:this.user.id,\r\n              password:this.passwordchangeValue\r\n          })\r\n        } catch (error) {\r\n          this.ErrorToasted(error)\r\n        }\r\n\r\n            this.$toasted.show(`Cập Nhập Thành công !!`, { \r\n              theme: \"bubble\",\r\n              position: \"bottom-right\", \r\n              duration : 3000\r\n          });\r\n      },\r\n    addFiles(){\r\n      this.$refs.files.click()\r\n    },\r\n    checkForm: function (e) {\r\n      if (this.titleRecord && this.diagnoseRecord) {\r\n        this.save()\r\n      }\r\n      this.errors = '';\r\n\r\n      if (!this.titleRecord) {\r\n        this.errors += 'Vui lòng nhập triệu chứng, lý do. <br> ';\r\n      }\r\n      if (!this.diagnoseRecord) {\r\n        this.errors += 'Vui lòng nhập chẩn đoán.';\r\n      }\r\n        this.$toasted.show(`${this.errors}`, {\r\n          theme: \"bubble\", \r\n          position: \"bottom-right\", \r\n          duration : 2000\r\n      });\r\n      this.errors = ''\r\n\r\n    },\r\n    handleFilesUpload () {\r\n      const allowedTypes = ['image/jpeg','image/svg+xml','image/png',\"image/gif\"];\r\n        let isError = true\r\n        this.messageError = \"\";\r\n        \r\n        let checkFilesUpload = this.$refs.files.files\r\n        let vm = this\r\n        // validate file\r\n        for (var i = 0; i < checkFilesUpload.length; i++) {\r\n          if(allowedTypes.includes(checkFilesUpload[i].type)){\r\n            isError = false\r\n          }else{\r\n            this.messageError = `Định dạng không cho phép !!! \r\n            Định dạng hình ảnh bao gồm image/jpeg || image/png || image/gif || image/svg  `;\r\n          }\r\n        }\r\n        \r\n        \r\n        if(!isError){\r\n          let uploadedFiles = this.$refs.files.files\r\n          for (var i = 0; i < uploadedFiles.length; i++) {\r\n            let reader = new FileReader()\r\n            reader.onload = function () {\r\n              vm.files.push({image: reader.result, file: reader.fileName})\r\n            }\r\n            reader.fileName = uploadedFiles[i].name\r\n            reader.readAsDataURL(uploadedFiles[i])\r\n          }\r\n       }\r\n\r\n    },\r\n    removeFile (key) {\r\n      this.files.splice(key, 1)\r\n    },\r\n    removeImage (key) {\r\n      this.files.splice(key, 1)\r\n    },\r\n    close(){\r\n       this.messageError = \"\";\r\n       this.$root.$emit('bv::hide::modal', 'modal-1', '#btnShow');\r\n    },\r\n    addNewDrugRecord(){\r\n     this.NewDrugs.push({\r\n        name:'',\r\n        id_record:'',\r\n        total:'',\r\n        morning:'',\r\n        midday:'',\r\n        afternoon:'',\r\n        night:'',\r\n        note:'',\r\n        user:null\r\n     })\r\n    },\r\n    removeNewDrugRecord(index){\r\n      this.NewDrugs.splice(index, 1);\r\n    },\r\n    refresh(){\r\n       this.doctor_email_record = ''\r\n       this.doctor_right_record = ''\r\n    },\r\n      async getUserRecords(){\r\n        try {\r\n            const response = (await DoctorService.getUserRecords({\r\n                email: this.doctor_email_record,\r\n                right: this.doctor_right_record\r\n            })).data\r\n            this.$store.dispatch(\"set_patientInfo\",response)    \r\n            const _patientrecords = (await PatientService.show(response.id_account)).data\r\n            this.$store.dispatch(\"update_inforRecordsPatientDetail\",_patientrecords)\r\n            this.isWriteRecord = true;\r\n            this.Istruycap = true;\r\n        }catch (error) {\r\n            this.error_access_record = error.response.data.error\r\n            }\r\n      },\r\n      end(){\r\n        this.Istruycap = false;\r\n        this.messageError = \"\";\r\n        this.isWriteRecord = false;\r\n        this.$store.dispatch(\"resetPatient_records\");\r\n        localStorage.removeItem('patient_records');\r\n      },\r\n      resetForm(){\r\n            this.doctor_email_record = '',\r\n            this.doctor_right_record='',\r\n            // this.isWriteRecord=false,\r\n            this.error_access_record=null,\r\n            this.titleRecord='',\r\n            this.diagnoseRecord='',\r\n            // this.Istruycap = false,\r\n            this.errors = [],\r\n            this.idRecord = null,\r\n            this.NewDrugs=[\r\n              {\r\n                name:'',\r\n                id_record:'',\r\n                total:'',\r\n                morning:'',\r\n                midday:'',\r\n                afternoon:'',\r\n                night:'',\r\n                note:'',            \r\n              }\r\n            ]\r\n            this.describe = '',\r\n            this.files = [],\r\n            this.isHideNewAlternativeRecord = true\r\n          this.$root.$emit('bv::hide::modal', 'modal-1', '#btnShow')     \r\n      },\r\n      async save(){\r\n                try {\r\n                    const response = (await DoctorService.saveRecord({\r\n                    id_patient: this.patientInfo.id_account,\r\n                    id_doctor: this.user.id,\r\n                    patient_title:this.titleRecord,\r\n                    patient_location:this.hospitalInfo.name_hospital,\r\n                    patient_time: new Date().toISOString().slice(0,10),\r\n                    patient_content: this.diagnoseRecord\r\n                    })).data\r\n                    this.idRecord = response.id\r\n      \r\n                    this.NewDrugs.forEach(element => {\r\n                      element.id_record = this.idRecord\r\n                    });\r\n                }catch (error) {\r\n                  this.error = error.response.data.error\r\n                }\r\n\r\n              if(this.NewDrugs.name){\r\n                try {\r\n                    const length =  this.NewDrugs.length\r\n                    const response = await DoctorService.saveDrugRecord({\r\n                      objects_drug:this.NewDrugs,\r\n                       length:length\r\n                    })\r\n                }catch (error) {\r\n                    this.error = error.response.data.error\r\n                    }\r\n              }\r\n\r\n                if(this.files){\r\n                  try {\r\n                    let length =  this.files.length\r\n                    const response = await DoctorService.saveAlternativeRecords({\r\n                      objects_files:this.files,\r\n                      describe:this.describe,\r\n                      id_record:this.idRecord,\r\n                      length:length,\r\n                    })\r\n                }catch (error) {\r\n                    this.error = error.response.data.error\r\n                    }\r\n                }\r\n                  this.$toasted.show(`Thành công !!`, { \r\n                    theme: \"bubble\", \r\n                    position: \"bottom-right\", \r\n                    duration : 2000\r\n                });\r\n                // this.getUserRecords();\r\n                this.resetForm()\r\n\r\n                \r\n      }\r\n  },\r\n}\r\n",{"version":3,"sources":["Doctor.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA","file":"Doctor.vue","sourceRoot":"src/components/content","sourcesContent":["<template>\r\n  <div>\r\n      <div class=\"container pt-5 mb-5\" v-if=\"isUserLoggedIn\">\r\n        <div class=\"search\" v-bind:class=\"{ CenterCSS: !this.Istruycap }\">\r\n          <h3 class=\"text-center title\">TÌM KIẾM BỆNH NHÂN  testing@gmail.com</h3>\r\n          <div class=\"content m-auto\">\r\n            <div class=\"col-md-12 col-sm-12 row\" v-if=\"isWriteRecord\">\r\n              <div class=\"p-2 col-sm-6 text-right\">\r\n                <!-- THEM HO SO MOI -->\r\n                  <div class=\"btn btn-success\" v-b-modal.modal-1>Thêm mới hồ sơ </div>\r\n                  \r\n                  <b-modal id=\"modal-1\" size='lg' title=\"Thêm bệnh án bệnh nhân\">\r\n                    <div class=\"row col-sm-12\">\r\n                        <div class=\"col-sm-3 p-2\">Triệu chứng, lý do</div>\r\n                        <div class=\"col-sm-9 p-2\">\r\n                          <input type=\"text\"  style=\"width:100%;\"  v-model=\"titleRecord\" class=\"pl-1\">\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"row col-sm-12\">\r\n                        <div class=\"col-sm-3 p-2\">Chẩn đoán</div>\r\n                        <div class=\"col-sm-9 p-2\">\r\n                          <input type=\"text\"  style=\"width:100%;\"  v-model=\"diagnoseRecord\" class=\"pl-1\">\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"row col-sm-12 text-left\">\r\n                      <div class=\"col-sm-12 d-flex\">\r\n                          <div class=\"add pb-3\" @click=\"addNewDrugRecord\">\r\n                            <img src=\"@/assets/images/plus.svg\" />\r\n                          </div>\r\n                          <div class=\"add add2 pb-3 pl-4\" @click=\"isHideNewAlternativeRecord = false \" v-show='isHideNewAlternativeRecord'>\r\n                            <img src=\"@/assets/images/add-image.svg\" />\r\n                          </div>\r\n                      </div>\r\n                <span style=\"width:100%\"  v-if=\"!isHideNewAlternativeRecord\">\r\n                  <div class=\"form col-sm-12 col-md-12 mb-2\">\r\n                        <div class=\"row pb-2 mx-1 justify-content-between\">\r\n                          <strong class=\"colorFile\">File Image </strong>\r\n                          <div class=\"close\" @click=\"isHideNewAlternativeRecord = true, messageError = '' \">x</div>\r\n                        </div>\r\n                          <div class=\"row pb-2\">\r\n                                <div class=\"col-sm-3\">\r\n                                  <label>Chọn File <input type=\"file\" multiple ref=\"files\" id=\"files\" accept=\"image/*\" @change=\"handleFilesUpload()\" /></label>\r\n                                </div> \r\n                                <div class=\"col-sm-9\">\r\n                                  <button v-on:click=\"addFiles()\">Add Files</button>\r\n                                </div>\r\n                                <div class=\"alert-error p-2\" v-if=\"messageError\">{{messageError}}</div>\r\n                          </div>\r\n      <hr>                   \r\n                          <div class=\"row\">\r\n                                <div class=\"col-sm-12\">\r\n                                  <textarea v-model=\"describe\" placeholder=\"Mô tả\"></textarea>\r\n                                </div>\r\n                          </div>\r\n      <hr>                   \r\n                          <div class=\"row mx-1\" v-if=\"files\">\r\n                            <div v-for=\"(file, key) in files\" class=\"file-listing d-flex justify-content-between py-1 d-block\">          \r\n                                <img class=\"preview\" :src=\"file.image\" />\r\n                                <span class=\"d-flex align-items-center name-preview\">{{ file.file }}</span>\r\n                                <span class=\"d-flex align-items-center btn btn-sm btn-warning pointer \" @click=\"removeImage( key )\">\r\n                                  Xóa\r\n                                </span>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                  </span>\r\n\r\n                      <div class=\"form col-sm-12 col-md-12 mb-2\" v-for=\"(newDrug,index) in NewDrugs\" :key=\"index +'-key'\">\r\n                        <!-- <div class=\"row justify-content-end mr-3 \"></div> -->\r\n                      <div class=\"row pb-2 mx-1 justify-content-between\">\r\n                        <strong class=\"colorDrug\">STT Thuốc {{index+1}}</strong>\r\n                        <div class=\"close\" @click=\"removeNewDrugRecord(index)\">x</div>\r\n                      </div>\r\n                        <div class=\"row pb-2\">\r\n                              <div class=\"col-sm-2\">Tên thuốc</div>\r\n                              <div class=\"col-sm-7\">\r\n                                <input type=\"text\" list=\"LoadListDrug\"  style=\"width:100%;\"  v-model=\"newDrug.name\" class=\"pl-1\">\r\n                                  <datalist id=\"LoadListDrug\">\r\n                                    <option v-for=\"(drug,index) in LoadListDrug\" :key=\"index\">{{drug}}</option>\r\n                                  </datalist>\r\n                              </div>        \r\n                              <div class=\"col-sm-3 symbol\">\r\n                                <select v-model=\"selected\">\r\n                                  <option disabled value=\"\">Tải DS Thuốc</option>\r\n                                  <option value=\"LoadListHopital\">Từ Bệnh Viện</option>\r\n                                  <option value=\"LoadListSystem\">Từ Hệ Thống</option>\r\n                                  <option value=\"None\">Không</option>\r\n                                </select>\r\n                              </div>           \r\n                        </div>\r\n                        <div class=\"row\">\r\n                              <div class=\"col-sm-2\">Số lượng</div>\r\n                              <div class=\"col-sm-7 \">\r\n                                <input type=\"number\" min=\"0\"  style=\"width:100%;\"   v-model=\"newDrug.total\" class=\"pl-1\">\r\n                              </div>\r\n                        </div> \r\n    <hr>\r\n                        <div class=\"row\">\r\n                              <div class=\"col-sm-3\">\r\n                                <input type=\"text\"  style=\"width:100%;\"   v-model=\"newDrug.morning\" placeholder=\"Sáng\">\r\n                              </div>\r\n                              <div class=\"col-sm-3\">\r\n                                <input type=\"text\"  style=\"width:100%;\"   v-model=\"newDrug.midday\" placeholder=\"Trưa\">\r\n                              </div>\r\n                              <div class=\"col-sm-3\">\r\n                                <input type=\"text\"  style=\"width:100%;\"   v-model=\"newDrug.afternoon\" placeholder=\"Chiều\">\r\n                              </div>\r\n                              <div class=\"col-sm-3\">\r\n                                <input type=\"text\"  style=\"width:100%;\"   v-model=\"newDrug.night\" placeholder=\"Tối\">\r\n                              </div>\r\n                        </div> \r\n    <hr>                   \r\n                        <div class=\"row\">\r\n                              <div class=\"col-sm-12\">\r\n                                <textarea v-model=\"newDrug.note\" placeholder=\"Ghi chú\"></textarea>\r\n                              </div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                        <template slot=\"modal-footer\">\r\n                          <b-button size=\"sm\" variant=\"success\" @click=\"checkForm()\">\r\n                            Lưu hồ sơ\r\n                          </b-button>\r\n                          <b-button size=\"sm\" variant=\"danger\" @click=\"close()\">\r\n                            Hủy{{this.NewDrugs.id_record}}\r\n                          </b-button>\r\n                        </template>\r\n                    \r\n                  </b-modal>\r\n                  \r\n              </div>\r\n              <div class=\"p-2 col-sm-6\">\r\n                <b-button variant=\"secondary\" @click=\"end\">Kết thúc</b-button>\r\n              </div>\r\n            </div>\r\n            <span v-else>\r\n                <div class=\"col-md-12 col-sm-12 row\" v-if=\"doctorInfo\">\r\n                  <div class=\"pb-3 col-sm-12 text-right\">Xin chào bác sĩ {{doctorInfo.firstname}} {{doctorInfo.lastname}}\r\n\r\n                    <b-dropdown size=\"sm\" dropleft variant=\"link\" toggle-class=\"text-decoration-none\" no-caret>\r\n                      <template v-slot:button-content>\r\n                        &#9656;<span class=\"sr-only\">Search</span>\r\n                      </template>\r\n                      <b-dropdown-item v-b-modal.modal-3>Đổi Mật Khẩu</b-dropdown-item>\r\n                    </b-dropdown>\r\n\r\n                      <b-modal id=\"modal-3\" title=\"Đổi Mật Khẩu\">\r\n                        <b class=\"my-4 d-flex justify-content-start\">Nhập Mật Khẩu Bạn Muốn Đổi:</b>\r\n                        <p class=\"my-4\"><input type=\"password\" placeholder=\"nhập mật khẩu\" class=\"inputStyle\" v-model=\"passwordchangeValue\"></p>\r\n                        <p class=\"my-4\"><input type=\"password\" placeholder=\"nhập lại mật khẩu\" class=\"inputStyle\" v-model=\"passwordchangeValueAgain\"></p>\r\n                        <template v-slot:modal-footer>\r\n                          <div class=\"w-100\">\r\n                            <b-button\r\n                              variant=\"warning\"\r\n                              size=\"sm\"\r\n                              class=\"float-right ml-3\"\r\n                              @click=\"validationPasswordChange\"\r\n                            >\r\n                              Gửi Yêu Cầu Đổi Mật Khẩu\r\n                            </b-button>\r\n                            \r\n                            <b-button\r\n                              variant=\"primary\"\r\n                              size=\"sm\"\r\n                              class=\"float-right\"\r\n                              @click=\"closeModal3\"\r\n                            >\r\n                              Đóng\r\n                            </b-button>\r\n                          </div>\r\n                        </template>\r\n                      </b-modal>\r\n\r\n                  </div>\r\n                \r\n                </div>\r\n                <div class=\"col-md-12 col-sm-12 row\">\r\n                  <div class=\"p-2 col-sm-6 text-right\">Nhập username bệnh nhân:</div>\r\n                  <div class=\"p-2 col-sm-6\"><input type=\"text\" style=\"width:60%;\" v-model=\"doctor_email_record\" ></div>\r\n                </div>\r\n                <div class=\"col-md-12 col-sm-12 row pb-3\">\r\n                  <div class=\"p-2 col-sm-6 text-right\">Nhập quyền truy cập (nếu có):</div>\r\n                  <div class=\"p-2 col-sm-6\"><input type=\"text\"  style=\"width:60%;\" v-model=\"doctor_right_record\" ></div>\r\n                </div>\r\n                <div v-if=\"error_access_record\" class=\"alert-error\">{{error_access_record}}</div>\r\n                <div class=\"d-flex justify-content-center btn-cus\">\r\n                  <div class=\"btn btn-success mr-2\" @click=\"getUserRecords\">Truy Cập</div>\r\n                  <div class=\"btn cancel-btn ml-2\" @click=\"refresh\">Làm mới</div>\r\n                </div>\r\n            </span>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"search\" v-if=\"this.Istruycap\">\r\n          <h3 class=\"text-center title\">Hồ sơ bệnh nhân</h3>\r\n            <div class=\"content\">\r\n              <div>\r\n                  <b-tabs card >\r\n                    <b-tab title=\"Hồ Sơ Bệnh Án\" active><app-TimeLine /></b-tab>\r\n                    <b-tab title=\"Dữ Liệu Bệnh Nhân\"><app-PatientData /></b-tab>\r\n                  </b-tabs>\r\n            </div>\r\n            </div>\r\n\r\n        </div>\r\n          \r\n      </div>\r\n      <div v-else>\r\n        <app-PageNotFound />\r\n      </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { mapGetters} from \"vuex\";\r\nimport DoctorService from '@/services/DoctorService'\r\nimport PageNotFound from '@/components/content/PageNotFound.vue'\r\nimport PatientView from '@/components/content/patient_modules/PatientView.vue'\r\nimport PatientData from '@/components/content/patient_modules/PatientData.vue'\r\nimport PatientService from '@/services/PatientService'\r\nimport HospitalService from '@/services/HospitalService'\r\nimport axios from 'axios'\r\nexport default {\r\n  data(){\r\n        return{\r\n            messageError:'',\r\n            selected:'',\r\n            doctor_email_record:'',          \r\n            doctor_right_record:'',\r\n            isWriteRecord:false,\r\n            error_access_record:null,\r\n            titleRecord:'',\r\n            diagnoseRecord:'',\r\n            errors: null,\r\n            Istruycap:false,\r\n            idRecord:null,\r\n            describe:'',\r\n            listSystem:'',\r\n            listDrug:'',\r\n            passwordchangeValue:'',\r\n            passwordchangeValueAgain:'',\r\n            get isUserLoggedIn() {\r\n                return localStorage.getItem('isUserLoggedIn' || false);\r\n              },\r\n            NewDrugs:[\r\n              {\r\n                name:'',\r\n                id_record:'',\r\n                total:'',\r\n                morning:'',\r\n                midday:'',\r\n                afternoon:'',\r\n                night:'',\r\n                note:'',\r\n              }\r\n            ],\r\n            \r\n            files: [],\r\n            isHideNewAlternativeRecord:true\r\n        }\r\n    },\r\n      computed: {\r\n        ...mapGetters([\"patient_records\",\"doctorInfo\",\"hospitalInfo\",\"patientInfo\"]),\r\n        LoadListDrug: function () {\r\n          if(this.selected == 'LoadListHopital'){\r\n            return this.listDrug;\r\n          }else if(this.selected == 'LoadListSystem'){\r\n            return this.listSystem;\r\n          }else{\r\n            return '';\r\n          }\r\n        }\r\n      },\r\n      components: {\r\n        \"app-TimeLine\": PatientView,  \r\n        \"app-PatientData\": PatientData,\r\n        \"app-PageNotFound\":PageNotFound\r\n      },\r\n    async mounted() {\r\n        const userCONST = JSON.parse(localStorage.getItem('user'));\r\n\r\n        if(userCONST){\r\n          this.user = userCONST\r\n          const id_account = JSON.parse(localStorage.getItem('user')).id;\r\n\r\n          const payload_doctor = (await DoctorService.getInfoDoctor(id_account)).data\r\n          this.$store.dispatch(\"setDoctorInfo\",payload_doctor)\r\n\r\n          const payload_hospital = (await HospitalService.getInfoHospital(payload_doctor.id_hospital)).data\r\n          this.$store.dispatch(\"setHospitalInfo\",payload_hospital);\r\n\r\n          const ListDrugHospital = (await HospitalService.getListDrugBank(userCONST.id)).data;\r\n          this.listDrug = ListDrugHospital.map(x=>x.tenThuoc)\r\n        }\r\n        await axios\r\n        .get('https://www.drugbank.vn/services/drugbank/api/public/thuoc?page=1&size=2000&fbclid=IwAR1vamwLTdSmIx8idqXMjg77a18AZ4nZYROoLE8dTTAR0sS4EUlvt7W3lMQ')\r\n        .then(response => (this.listSystem = response.data.filter(x=>x.tenThuoc).map(x=>x.tenThuoc)));\r\n      },\r\n  methods: {\r\n      validationPasswordChange(){\r\n        if(!this.passwordchangeValue || !this.passwordchangeValueAgain){\r\n            this.$toasted.show('Vui Lòng Nhập Đầy Đủ Thông Tin !!!', { \r\n            theme: \"bubble\",\r\n            position: \"bottom-right\", \r\n            duration : 4000\r\n        });\r\n        }else if(this.passwordchangeValue !== this.passwordchangeValueAgain){\r\n          this.$toasted.show(`Mật Khẩu Và Mật Khẩu Xác Nhận Không Giống Nhau !!!<br>Vui Lòng Kiểm Tra Lại !!!`, { \r\n            theme: \"bubble\", \r\n            position: \"bottom-right\", \r\n            duration : 5000\r\n        });\r\n        }else if(this.passwordchangeValue.length < 8){\r\n          this.$toasted.show(`Mật khẩu được cung cấp phải khớp với các quy tắc sau:\\n            <br><br>\\n            1. Nó phải chứa chỉ các ký tự sau: chữ thường, chữ hoa, chữ số.\\n            <br><br>\\n            2. mật khẩu dài ít nhất 8 kí tự và không dài hơn 32 kí tự.\\n            </div>\\n        `, { \r\n            theme: \"bubble\", \r\n            position: \"bottom-right\", \r\n            duration : 4000\r\n        });\r\n        }else{\r\n          this.changepassword();\r\n          this.closeModal3();\r\n        }\r\n    },\r\n    closeModal3(){\r\n        this.passwordchangeValue = ''\r\n        this.passwordchangeValueAgain = ''\r\n        this.$root.$emit('bv::hide::modal', \"modal-3\", \"button\")\r\n      },\r\n    async changepassword(){\r\n        try {\r\n            await PatientService.changePassword({\r\n              id_account:this.user.id,\r\n              password:this.passwordchangeValue\r\n          })\r\n        } catch (error) {\r\n          this.ErrorToasted(error)\r\n        }\r\n\r\n            this.$toasted.show(`Cập Nhập Thành công !!`, { \r\n              theme: \"bubble\",\r\n              position: \"bottom-right\", \r\n              duration : 3000\r\n          });\r\n      },\r\n    addFiles(){\r\n      this.$refs.files.click()\r\n    },\r\n    checkForm: function (e) {\r\n      if (this.titleRecord && this.diagnoseRecord) {\r\n        this.save()\r\n      }\r\n      this.errors = '';\r\n\r\n      if (!this.titleRecord) {\r\n        this.errors += 'Vui lòng nhập triệu chứng, lý do. <br> ';\r\n      }\r\n      if (!this.diagnoseRecord) {\r\n        this.errors += 'Vui lòng nhập chẩn đoán.';\r\n      }\r\n        this.$toasted.show(`${this.errors}`, {\r\n          theme: \"bubble\", \r\n          position: \"bottom-right\", \r\n          duration : 2000\r\n      });\r\n      this.errors = ''\r\n\r\n    },\r\n    handleFilesUpload () {\r\n      const allowedTypes = ['image/jpeg','image/svg+xml','image/png',\"image/gif\"];\r\n        let isError = true\r\n        this.messageError = \"\";\r\n        \r\n        let checkFilesUpload = this.$refs.files.files\r\n        let vm = this\r\n        // validate file\r\n        for (var i = 0; i < checkFilesUpload.length; i++) {\r\n          if(allowedTypes.includes(checkFilesUpload[i].type)){\r\n            isError = false\r\n          }else{\r\n            this.messageError = `Định dạng không cho phép !!! \r\n            Định dạng hình ảnh bao gồm image/jpeg || image/png || image/gif || image/svg  `;\r\n          }\r\n        }\r\n        \r\n        \r\n        if(!isError){\r\n          let uploadedFiles = this.$refs.files.files\r\n          for (var i = 0; i < uploadedFiles.length; i++) {\r\n            let reader = new FileReader()\r\n            reader.onload = function () {\r\n              vm.files.push({image: reader.result, file: reader.fileName})\r\n            }\r\n            reader.fileName = uploadedFiles[i].name\r\n            reader.readAsDataURL(uploadedFiles[i])\r\n          }\r\n       }\r\n\r\n    },\r\n    removeFile (key) {\r\n      this.files.splice(key, 1)\r\n    },\r\n    removeImage (key) {\r\n      this.files.splice(key, 1)\r\n    },\r\n    close(){\r\n       this.messageError = \"\";\r\n       this.$root.$emit('bv::hide::modal', 'modal-1', '#btnShow');\r\n    },\r\n    addNewDrugRecord(){\r\n     this.NewDrugs.push({\r\n        name:'',\r\n        id_record:'',\r\n        total:'',\r\n        morning:'',\r\n        midday:'',\r\n        afternoon:'',\r\n        night:'',\r\n        note:'',\r\n        user:null\r\n     })\r\n    },\r\n    removeNewDrugRecord(index){\r\n      this.NewDrugs.splice(index, 1);\r\n    },\r\n    refresh(){\r\n       this.doctor_email_record = ''\r\n       this.doctor_right_record = ''\r\n    },\r\n      async getUserRecords(){\r\n        try {\r\n            const response = (await DoctorService.getUserRecords({\r\n                email: this.doctor_email_record,\r\n                right: this.doctor_right_record\r\n            })).data\r\n            this.$store.dispatch(\"set_patientInfo\",response)    \r\n            const _patientrecords = (await PatientService.show(response.id_account)).data\r\n            this.$store.dispatch(\"update_inforRecordsPatientDetail\",_patientrecords)\r\n            this.isWriteRecord = true;\r\n            this.Istruycap = true;\r\n        }catch (error) {\r\n            this.error_access_record = error.response.data.error\r\n            }\r\n      },\r\n      end(){\r\n        this.Istruycap = false;\r\n        this.messageError = \"\";\r\n        this.isWriteRecord = false;\r\n        this.$store.dispatch(\"resetPatient_records\");\r\n        localStorage.removeItem('patient_records');\r\n      },\r\n      resetForm(){\r\n            this.doctor_email_record = '',\r\n            this.doctor_right_record='',\r\n            // this.isWriteRecord=false,\r\n            this.error_access_record=null,\r\n            this.titleRecord='',\r\n            this.diagnoseRecord='',\r\n            // this.Istruycap = false,\r\n            this.errors = [],\r\n            this.idRecord = null,\r\n            this.NewDrugs=[\r\n              {\r\n                name:'',\r\n                id_record:'',\r\n                total:'',\r\n                morning:'',\r\n                midday:'',\r\n                afternoon:'',\r\n                night:'',\r\n                note:'',            \r\n              }\r\n            ]\r\n            this.describe = '',\r\n            this.files = [],\r\n            this.isHideNewAlternativeRecord = true\r\n          this.$root.$emit('bv::hide::modal', 'modal-1', '#btnShow')     \r\n      },\r\n      async save(){\r\n                try {\r\n                    const response = (await DoctorService.saveRecord({\r\n                    id_patient: this.patientInfo.id_account,\r\n                    id_doctor: this.user.id,\r\n                    patient_title:this.titleRecord,\r\n                    patient_location:this.hospitalInfo.name_hospital,\r\n                    patient_time: new Date().toISOString().slice(0,10),\r\n                    patient_content: this.diagnoseRecord\r\n                    })).data\r\n                    this.idRecord = response.id\r\n      \r\n                    this.NewDrugs.forEach(element => {\r\n                      element.id_record = this.idRecord\r\n                    });\r\n                }catch (error) {\r\n                  this.error = error.response.data.error\r\n                }\r\n\r\n              if(this.NewDrugs.name){\r\n                try {\r\n                    const length =  this.NewDrugs.length\r\n                    const response = await DoctorService.saveDrugRecord({\r\n                      objects_drug:this.NewDrugs,\r\n                       length:length\r\n                    })\r\n                }catch (error) {\r\n                    this.error = error.response.data.error\r\n                    }\r\n              }\r\n\r\n                if(this.files){\r\n                  try {\r\n                    let length =  this.files.length\r\n                    const response = await DoctorService.saveAlternativeRecords({\r\n                      objects_files:this.files,\r\n                      describe:this.describe,\r\n                      id_record:this.idRecord,\r\n                      length:length,\r\n                    })\r\n                }catch (error) {\r\n                    this.error = error.response.data.error\r\n                    }\r\n                }\r\n                  this.$toasted.show(`Thành công !!`, { \r\n                    theme: \"bubble\", \r\n                    position: \"bottom-right\", \r\n                    duration : 2000\r\n                });\r\n                // this.getUserRecords();\r\n                this.resetForm()\r\n\r\n                \r\n      }\r\n  },\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n* {\r\n  font-family: Arial, Helvetica, sans-serif;\r\n  font-size: 14px;\r\n}\r\n.title{\r\n  margin: 0;\r\n  border-bottom: none !important;\r\n  background: #40c4ff;\r\n  color:white;\r\n}\r\n.search h3{\r\n  padding:0.5rem;\r\n  border: 2px solid #40c4ff;\r\n}\r\n.content{\r\n  padding:0.5rem;\r\n  border: 2px solid #40c4ff;\r\n}\r\ninput{\r\n  border:1px solid rgb(0, 0, 0,.3);\r\n  border-radius: 2px;\r\n}\r\n.btn-cus{\r\n  padding-left: 28vw;\r\n}\r\n.cancel-btn{\r\n    border: 1px solid #ccd0d5;\r\n    border-radius: 2px;\r\n    background-color: #f5f6f7;\r\n    cursor: pointer;\r\n}   \r\n.card-header-tabs{\r\n  padding: 10rem;\r\n  color: red;\r\n}\r\n.alert-error{\r\n  text-align: center;\r\n  color: red;\r\n}\r\n.add img{\r\n  height: 2rem;\r\n  width: 2rem;\r\n  border-radius: 50%;\r\n}\r\n.add2 img{\r\n  border-radius: 0;\r\n}\r\n.add{\r\n  cursor: pointer;\r\n}\r\n.add img:hover{\r\n    -webkit-box-shadow: 2px 2px 15px 0px rgba(183,214,240,1);\r\n    -moz-box-shadow: 2px 2px 15px 0px rgba(183,214,240,1);\r\n    box-shadow: 2px 2px 15px 0px rgba(183,214,240,1);\r\n}\r\n.close{\r\n  cursor: pointer;\r\n}\r\n.close:hover{\r\n    -webkit-box-shadow: 2px 2px 5px 0px rgba(183,214,240,1);\r\n    -moz-box-shadow: 2px 2px 5px 0px rgba(183,214,240,1);\r\n    box-shadow: 2px 2px 5px 0px rgba(183,214,240,1);\r\n}\r\ntextarea\r\n{\r\n  width:100%;\r\n}\r\n.form{\r\n  padding:0.5rem;\r\n  border: 1px solid rgb(0, 0, 0,.4)\r\n}\r\n.danger-alert{\r\n  color:red\r\n}\r\n.Custominput img {\r\n  max-width: 100%;\r\n  max-height: 500px;\r\n}\r\n.colorDrug{\r\n  color: #F44336;\r\n}\r\n.colorFile{\r\n  color:#9C27B0;\r\n}\r\ninput[type=\"file\"]{\r\n  position: absolute;\r\n  top: -500px;\r\n}\r\ndiv.file-listing img{\r\n  max-width: 40%;\r\n}\r\n.name-preview{\r\n  border:1px solid rgb(170, 170, 170,.3);\r\n  padding:0.5rem;\r\n  overflow: overlay;\r\n  max-width: 300px;\r\n  word-wrap: break-word;\r\n}\r\n.pointer{\r\n  cursor: pointer;\r\n}\r\n.CenterCSS{\r\n  margin-bottom: 10vh;\r\n  margin-top: 9vh;\r\n}\r\n.inputStyle{\r\n  padding: 0.25rem;\r\n  border:1px solid #aaa;\r\n  border-radius:4px;\r\n  width:100%;\r\n}\r\n.symbol span{\r\n  font-size: 1.2rem;\r\n  cursor: pointer;\r\n}\r\n</style>\r\n"]}]}